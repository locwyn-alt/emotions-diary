<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–î–Ω–µ–≤–Ω–∏–∫ —ç–º–æ—Ü–∏–π</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #fdf6f0; padding: 15px; }
    .filter-buttons { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
    .filter-buttons button { padding: 8px 12px; border: none; border-radius: 8px; background: #e0d7f7; cursor: pointer; white-space: nowrap; }
    .filter-buttons button.active { background: #9c27b0; color: white; }
    .entry { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .entry h3 { margin: 0 0 10px; color: #6a1b9a; }
    .entry p { margin: 5px 0; font-size: 14px; }
  </style>
</head>
<body>

  <div class="filter-buttons" id="filters"></div>
  <div id="entries">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <script>
    const EMOTIONS = [
      { id: "all", text: "–í—Å–µ —ç–º–æ—Ü–∏–∏" },
      { id: "joy", text: "üòä –†–∞–¥–æ—Å—Ç—å / –≤–æ—Å—Ç–æ—Ä–≥" },
      { id: "sadness", text: "üò¢ –ì—Ä—É—Å—Ç—å / –ø–µ—á–∞–ª—å" },
      { id: "anger", text: "üò† –ó–ª–æ—Å—Ç—å / –¥–æ—Å–∞–¥–∞" },
      { id: "fear", text: "üò® –°—Ç—Ä–∞—Ö / —Ç—Ä–µ–≤–æ–≥–∞" },
      { id: "surprise", text: "üòÆ –£–¥–∏–≤–ª–µ–Ω–∏–µ / –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ" },
      { id: "disgust", text: "ü§¢ –ë—Ä–µ–∑–≥–ª–∏–≤–æ—Å—Ç—å / —Å–∫—É–∫–∞" },
      { id: "interest", text: "üßê –û–∂–∏–¥–∞–Ω–∏–µ / –∏–Ω—Ç–µ—Ä–µ—Å" },
      { id: "trust", text: "ü§ó –î–æ–≤–µ—Ä–∏–µ / –ø—Ä–∏–Ω—è—Ç–∏–µ" }
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const clientId = urlParams.get("client_id");
    let currentEmotion = "all";

    const filters = document.getElementById("filters");
    EMOTIONS.forEach(em => {
      const btn = document.createElement("button");
      btn.textContent = em.text;
      btn.dataset.id = em.id;
      if (em.id === "all") btn.classList.add("active");
      btn.onclick = () => {
        document.querySelectorAll("button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentEmotion = em.id;
        loadEntries();
      };
      filters.appendChild(btn);
    });

    function loadEntries() {
      const apiUrl = `https://script.google.com/macros/s/AKfycbxng3-CbqTgqnC8euxI-H5FMTp8Rvj32ThnKvI04OOGrv5eGjPJbbkrXOF4Cv8wcjtrtQ/exec?action=get_json&client_id=${clientId}&emotion_id=${currentEmotion}`;
      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("entries");
          container.innerHTML = "";
          if (!data.entries.length) {
            container.innerHTML = "<p>–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç üôà</p>";
            return;
          }
          data.entries.forEach(entry => {
            const el = document.createElement("div");
            el.className = "entry";
            el.innerHTML = `
              <h3>${entry.emotion_type}</h3>
              <p><b>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</b> ${entry.emotion_intens}/10</p>
              <p><b>–°–∏—Ç—É–∞—Ü–∏—è:</b> ${entry.emotion_context}</p>
              <p><b>–†–µ–∞–∫—Ü–∏—è:</b> ${entry.emotion_reflex}</p>
              <p><b>–ú—ã—Å–ª–∏:</b> ${entry.emotion_think}</p>
              <p><em>${entry.date}</em></p>
            `;
            container.appendChild(el);
          });
        });
    }

    loadEntries();
  </script>

</body>
</html>
