<script>
  function getClientIdFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("client_id");
  }

  async function fetchEmotions(clientId) {
    const response = await fetch(`https://script.google.com/macros/s/AKfycbxID_jyzS4sGpjnLUZycfsbGoCuoqKQCzRjv_AoqnjeqWEV57ZL7qDgn5KIpWdpO-73/exec?client_id=${clientId}`);
    const data = await response.json();
    renderEmotions(data.entries);
  }

  function renderEmotions(entries) {
    const container = document.getElementById("emotion-list");
    container.innerHTML = "";

    entries.forEach(entry => {
      const div = document.createElement("div");
      div.className = "emotion-entry";
      div.innerHTML = `
        <strong>${entry.emotion_type}</strong> (${entry.emotion_intens}/10)<br>
        <em>${new Date(entry.date).toLocaleString()}</em><br>
        <div style="margin-top:4px;">
          <span><b>Контекст:</b> ${entry.emotion_context}</span><br>
          <span><b>Рефлексия:</b> ${entry.emotion_reflex}</span><br>
          <span><b>Мысли:</b> ${entry.emotion_think}</span>
        </div>
        <hr>
      `;
      container.appendChild(div);
    });
  }

  const clientId = getClientIdFromURL();
  if (clientId) {
    fetchEmotions(clientId);
  } else {
    document.getElementById("emotion-list").innerHTML = `
      <p style="color:#888;">Не удалось получить client_id. Пожалуйста, откройте страницу через Salebot или добавьте параметр client_id в ссылке.</p>
    `;
  }
</script>
